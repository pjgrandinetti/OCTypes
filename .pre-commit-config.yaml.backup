repos:
  # Pre-commit hooks for code formatting and linting
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.4.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-added-large-files
      - id: check-merge-conflict

  # C/C++ specific tools
  - repo: https://github.com/pocc/pre-commit-hooks
    rev: v1.3.5
    hooks:
      # Code formatting with clang-format
      - id: clang-format
        args: [--style=file, --fallback-style=LLVM]
        files: \.(c|h)$
        exclude: ^(build/|docs/|src/cJSON)

      # Static analysis with clang-tidy
      - id: clang-tidy
        args:
          - --checks=-*,readability-*,bugprone-*,performance-*
          - --header-filter=src/.*\.h
          - --format-style=file
        files: \.(c|h)$
        exclude: ^(build/|docs/|src/cJSON)

      # Static analysis with cppcheck
      - id: cppcheck
        args:
          - --error-exitcode=1
          - --enable=warning,style,performance,portability
          - --suppress=missingIncludeSystem
          - --suppress=unusedFunction
          - --suppress=unmatchedSuppression
          - --inline-suppr
        files: \.(c|h)$
        exclude: ^(build/|docs/|src/cJSON)
          - --suppress=unusedStructMember
          - --suppress=knownConditionTrueFalse
          - --inline-suppr
          - --error-exitcode=0
        require_serial: true

  # OCTypes build verification (basic check)
  - repo: local
    hooks:
      - id: octypes-build-test
        name: OCTypes Build Test
        entry: bash
        language: system
        pass_filenames: false
        files: \.(c|h|y|l)$
        exclude: ^(docs/|\.git/|tests/)
        args:
          - -c
          - |
            set -e
            echo "🔨 Building OCTypes library..."
            make clean > /dev/null 2>&1 || true
            if ! make lib/libOCTypes.a -j4 > build.log 2>&1; then
              echo "❌ Library build failed. Check build.log for details."
              tail -10 build.log
              exit 1
            fi
            echo "✅ Library build successful"
        require_serial: true

  # OCTypes test verification (basic check)
  - repo: local
    hooks:
      - id: octypes-test
        name: OCTypes Test Suite
        entry: bash
        language: system
        pass_filenames: false
        files: \.(c|h|y|l)$
        exclude: ^(docs/|\.git/)
        args:
          - -c
          - |
            set -e
            echo "🧪 Running basic OCTypes tests..."
            if ! make test > test.log 2>&1; then
              echo "❌ Tests failed. Check test.log for details."
              tail -10 test.log
              exit 1
            fi
            echo "✅ Basic tests passed"
        require_serial: true
