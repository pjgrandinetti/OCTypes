repos:
  # Pre-commit hooks for code formatting and linting
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.4.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-added-large-files
      - id: check-merge-conflict

  # C/C++ code formatting with clang-format
  - repo: https://github.com/pre-commit/mirrors-clang-format
    rev: v16.0.6
    hooks:
      - id: clang-format
        files: \.(c|h)$
        args: [-i]

  # Static analysis with clang-tidy (less strict for now)
  - repo: local
    hooks:
      - id: clang-tidy
        name: clang-tidy
        entry: clang-tidy
        language: system
        files: \.(c|h)$
        exclude: ^(build/|docs/|tests/|src/cJSON)
        args:
          - --config-file=.clang-tidy
          - --header-filter=src/.*
        require_serial: true

  # Static analysis with cppcheck (less strict for now)
  - repo: local
    hooks:
      - id: cppcheck
        name: cppcheck
        entry: cppcheck
        language: system
        files: \.(c|h)$
        exclude: ^(build/|docs/|src/cJSON)
        args:
          - --enable=warning,style,performance,portability
          - --suppress=missingIncludeSystem
          - --suppress=unusedFunction
          - --suppress=unmatchedSuppression
          - --suppress=constVariablePointer
          - --suppress=constParameterPointer
          - --suppress=nullPointerOutOfMemory
          - --suppress=unusedStructMember
          - --suppress=knownConditionTrueFalse
          - --inline-suppr
          - --error-exitcode=0
        require_serial: true

  # OCTypes build verification (basic check)
  - repo: local
    hooks:
      - id: octypes-build-test
        name: OCTypes Build Test
        entry: bash
        language: system
        pass_filenames: false
        files: \.(c|h|y|l)$
        exclude: ^(docs/|\.git/|tests/)
        args:
          - -c
          - |
            set -e
            echo "🔨 Building OCTypes library..."
            make clean > /dev/null 2>&1 || true
            if ! make lib/libOCTypes.a -j4 > build.log 2>&1; then
              echo "❌ Library build failed. Check build.log for details."
              tail -10 build.log
              exit 1
            fi
            echo "✅ Library build successful"
        require_serial: true

  # OCTypes test verification (basic check)
  - repo: local
    hooks:
      - id: octypes-test
        name: OCTypes Test Suite
        entry: bash
        language: system
        pass_filenames: false
        files: \.(c|h|y|l)$
        exclude: ^(docs/|\.git/)
        args:
          - -c
          - |
            set -e
            echo "🧪 Running basic OCTypes tests..."
            if ! make test > test.log 2>&1; then
              echo "❌ Tests failed. Check test.log for details."
              tail -10 test.log
              exit 1
            fi
            echo "✅ Basic tests passed"
        require_serial: true
